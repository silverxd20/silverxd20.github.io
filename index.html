<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Precio de productos Wow</title>
    <link rel="icon" href="https://findicons.com/files/icons/679/nx10/128/world_of_warcraft.png">

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>

    <!-- ************************** HTML MODAL *************************** -->

    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ventanaTitulo"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <!-- Todo dentro de la ventanita -->
                    <div id="divForm" class="divForm">
                        <form action="">
                            <label for="fname">Precio de venta:</label><br>
                            <input type="number" class="Pventa" id="PventaId" name="fname">
                            <b for="moneda" id="monedaId"></b>
                            <br><br>
                            <input onclick="cambiarPrecioVntaBtn()" type="button" value="Cambiar">
                        </form>
                    </div>
                    <br>
                    <table id="tablaVerificacion" border="1">
                        <tr>
                            <th>Día</th>
                            <th>#</th>
                            <th>Precio alcanzado</th>
                            <th>Hora</th>
                        </tr>
                    </table>
                    <!-- FIN DE Todo dentro de la ventanita -->
                </div>
            </div>
        </div>
    </div>

    <!-- ************************* HTML PRINCIPAL *************************** -->

    <h1 id="titulo">Protuctos en subasta (Wow TBC)</h1>
    <select onchange="SeleccionListaProducto()" id="dropdownProductos">
        <option value="Pergaminos">Pergaminos</option>
        <option value="Plantas de classic">Plantas de classic</option>
        <option value="Plantas de TBC">Plantas de TBC</option>
        <option value="Menas">Menas</option>
    </select>

    <b>Idioma:</b>
    <select onchange="SeleccionListaTraductor()" id="dropdownTraductor">
        <option value="Español">Español</option>
        <option value="Ingles">Ingles</option>
    </select>

    <p id="lastUpdated"></p>
    <button style="display:none" onclick="activarCors()" id="corsBtn">Activar Cors</button>
    <br></br>

    <table id="productos" border="1">
        <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>Precio Compra</th>
            <th>Compra hasta el 15%</th>
            <th>Precio de venta</th>
            <th>Ganancia Aproximada</th>
            <th id="porcentaje">%</th>
            <th>HeapMap</th>
            <th>Herramienta</th>
        </tr>
    </table>

    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }

        th,
        td {
            text-align: left;
            padding: 8px;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2
        }

        th {
            background-color: #002169;
            color: white;
            cursor: pointer;
        }
    </style>

    <script>

        //Array con plantas de vanilla
        urlPlantasVanilla = [
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/peacebloom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/silverleaf",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/earthroot",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Mageroyal",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Briarthorn",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Stranglekelp",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Bruiseweed",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Wild-Steelbloom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Grave-Moss",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Kingsblood",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Liferoot",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Fadeleaf",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Goldthorn",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/khadgars-whisker",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Wintersbite",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Firebloom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Purple-Lotus",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/arthas-tears",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Sungrass",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Blindweed",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Ghost-Mushroom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Gromsblood",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Golden-Sansam",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Dreamfoil",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Mountain-Silversage",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Plaguebloom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Icecap",
        ]

        //Array con plantas de TBC
        urlPlantasTBC = [
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/felweed",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/terocone",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/mana-thistle",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/ragveil",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/netherbloom",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/ancient-lichen",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/nightmare-vine",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/dreaming-glory"
        ]

        //Array con Pergaminos
        urlPergaminos = [
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-agility-iv",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-agility-v",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-spirit-v",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-strength-iv",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-strength-v"
        ]

        //Array con todas las menas
        urlMenas = [
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/copper-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/tin-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/iron-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/silver-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/gold-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/mithril-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Truesilver-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Dark-Iron-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Thorium-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/fel-iron-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/adamantite-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Khorium-ore",
            "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/Nethercite-ore"
        ]

        let tablaProducto = document.getElementById('productos');
        let cuerpoTabla = document.createElement('tbody');
        let corsBoton = document.getElementById('corsBtn');
        let ventanaTituloId = document.getElementById("ventanaTitulo")
        let monedaNombreId = document.getElementById("monedaId")
        let positivoNegativo = ""

        //VARIABLES DEL LA VENTANITA
        let tablaVerificacion = document.getElementById('tablaVerificacion');
        let tbody = document.createElement('tbody');
        campoTextPrecioVentaID = document.getElementById("PventaId")
        let campoTextoValor = document.getElementById("PventaId").value
        PrecioVenta = parseFloat(campoTextoValor) * 10000
        diaSemana = ""
        diaSemanaAnterior = "Sat"
        cantidades = 0

        //obtiene el valor de ambos dropdown
        dropdownProductosValor = document.getElementById("dropdownProductos").value
        dropdownTraductorValor = document.getElementById("dropdownTraductor").value
        let urlNexusArray = []
        let NombreProductoArray = new Array()

        //Carga la hora del ultimo escarneo
        lastUpdated()

        //Inicia la pagina cargando los pergaminos
        urlPergaminos.forEach(function (links, index, array) {
            traerProductoDatos(links, index, array, dropdownTraductorValor)
        });

        tablaVerificacion.appendChild(tbody);
        tablaProducto.appendChild(cuerpoTabla);

        //Abre los URL de los productos trae sus datos en una tablas (Funcion principal)
        async function traerProductoDatos(Url, indice, array, idioma) {

            while (true) {
                try {
                    corsurl = "https://cors-anywhere.herokuapp.com/"
                    //abre el url
                    const respuesta = await fetch(corsurl + Url)
                    const json = await respuesta.json()
                    //Variable del producto
                    productName = json.name
                    uniqueName = json.uniqueName
                    imagen = json.icon
                    precioMinimo = json.stats.current.minBuyout / 10000
                    precioMinimoRaw = json.stats.current.minBuyout / 10000
                    precioPromedio = await json.stats.current.marketValue / 10000
                    gananciaEstimada = gananciaPromedia(precioMinimo, precioPromedio).toFixed(4)
                    porcentajeGanancia = gananciaEstimada / precioMinimoRaw * 100
                    cantidades = await json.stats.current.quantity
                    //Verifica si el idioma es español
                    if (idioma == "Español") {
                        productName = TraduccionName(productName);
                    }

                    //agrega los datos a a tabla
                    let fila = document.createElement('tr');

                    //la imagen del producto
                    var div_caption = document.createElement('div');
                    var img = document.createElement('img');
                    img.src = imagen;
                    fila.appendChild(div_caption);
                    fila.appendChild(img);

                    //crea el nombre
                    td = document.createElement('td');
                    td.innerText = productName
                    td.setAttribute("style", "font-weight:bold");
                    fila.appendChild(td);

                    //crea el precio minimo
                    td = document.createElement('td');
                    td.setAttribute("style", "font-weight:bold");
                    td.innerText = PlataOro(precioMinimo);
                    fila.appendChild(td);

                    //crea el compra hasta el 15%
                    td = document.createElement('td');
                    let compraMaxima = CompraMaxima(precioPromedio, porcentajeGanancia)
                    if (compraMaxima == "-") {
                        td.innerText = compraMaxima;
                    } else {
                        td.innerText = PlataOro(compraMaxima);
                    }
                    td.setAttribute("style", "font-weight:bold");
                    fila.appendChild(td);

                    //crea el precio promedio
                    td = document.createElement('td');
                    td.innerText = PlataOro(precioPromedio);
                    td.setAttribute("style", "font-weight:bold");
                    fila.appendChild(td);

                    //crea la ganancia estimada
                    td = document.createElement('td');
                    td.innerText = PlataOro(gananciaEstimada);
                    //agrega color verde si es positivo y rojo si es negativo
                    if (positivoNegativo == true) {
                        td.setAttribute("style", "color:#045900");
                    } else {
                        td.setAttribute("style", "color:red");
                    }
                    fila.appendChild(td);

                    //crea el % de ganancia
                    td = document.createElement('tr');
                    td = document.createElement('td');
                    if (positivoNegativo == true) {
                        td.setAttribute("style", "color:#045900");
                    } else {
                        td.setAttribute("style", "color:red");
                    }
                    td.innerText = parseFloat(porcentajeGanancia).toFixed(2) + " %";
                    fila.appendChild(td);

                    //crea el boton para ver el heapmap
                    td = document.createElement('tr');
                    td = document.createElement("td");
                    urlNexus = "https://nexushub.co/wow-classic/items/pagle-alliance/"
                    td.innerText = "Ver";
                    td.onclick = function (evt) {
                        window.open(
                            urlNexus + array[indice].split("/")[7], "_blank");
                    }
                    fila.appendChild(td);

                    //crea el boton de la heramienta de venta
                    td = document.createElement('tr');
                    td = document.createElement("td");
                    NombreProductoArray.push(productName)
                    td.innerText = "Abrir";
                    td.setAttribute("data-bs-toggle", "modal")
                    td.setAttribute("data-bs-target", "#staticBackdrop")
                    td.onclick = function (evt) {
                        //agarra el texto de la tabla y lo coloca en la ventana segun el producto
                        campoTextPrecioVentaID = document.getElementById("PventaId")
                        //pone el nombre del producto en el titulo de la ventanita
                        NombreProductoClickeado = evt.path[1].childNodes[2].innerHTML
                        ventanaTituloId.innerText = NombreProductoClickeado

                        //obtiene el valor del precio de venta sugerido en la tabla
                        precioVentaEnTablaTexto = evt.path[1].childNodes[5].innerHTML
                        precioVentaEnTablaNro = evt.path[1].childNodes[5].innerHTML.split(" ")[0]
                        tipoMonedaOroPlataBronce = evt.path[1].childNodes[5].innerHTML.split(" ")[1]
                        console.log("precio tabla:"+ precioVentaEnTablaNro)
                        //pone el precio obtenido de la tabla "precio venta" en el campo de texto
                        campoTextPrecioVentaID.value = precioVentaEnTablaNro
                        console.log("valor del campo:"+ campoTextPrecioVentaID.value)
                        //Pone al lado de campo de texto el tipo de moneda
                        monedaNombreId.innerText = tipoMonedaOroPlataBronce

                        //Nombre del producto con guion ejemp: scroll-of-agility-iv
                        nombreUnico = array[indice].split("/")[7]

                        //inicia la consulta
                        SolicitarDatos(precioVentaEnTablaNro, tipoMonedaOroPlataBronce, nombreUnico)

                    }
                    fila.appendChild(td);

                    cuerpoTabla.appendChild(fila);
                    break

                } catch (error) {
                    //captura el error cuando pide cors y hace visible el boton
                    if (SyntaxError) {
                        console.log(SyntaxError)
                        console.log("Es el error del cors")
                        corsBoton.style.display = "inherit"
                    } else if (TypeError) {
                        "Salio el fail to fetch"
                    }
                    sleep(2000)
                }
            }
        }

        //pone los numero en 0 como plata si no lo deja en oro
        function PlataOro(nro) {

            PrecioFloat = nro
            if (PrecioFloat > 1) {
                //si es positivo y es oro
                precioMinimo = parseFloat(PrecioFloat).toFixed(2) + " Oro"
                positivoNegativo = true

            } else if (PrecioFloat > 0.01) {
                //si es positivo y es plata
                precioMinimo = parseFloat(PrecioFloat).toFixed(4) * 100 + " Plata"
                if (precioMinimo == 1) {
                    precioMinimo = PrecioFloat + " Oro"
                }
                positivoNegativo = true

            } else if (PrecioFloat > 0.001) {
                //si es positivo y es cobre
                precioMinimo = PrecioFloat * 10000 + " Cobre"
                positivoNegativo = true
            } else {
                //aqui esto es negativo
                precioMinimo = PrecioFloat * 100
                positivoNegativo = false

                if (precioMinimo < -100) {
                    //si esto es negativo y pasa de -100
                    precioMinimo = parseFloat(precioMinimo / 100).toFixed(2) + " Oro"

                } else {
                    //si esto es negativo y es menor a -100
                    precioMinimo = PrecioFloat * 100 + " Plata"
                }
            }
            return precioMinimo;
        }

        //Dice la ganancia si se publica al precio promedio
        function gananciaPromedia(preMinimo, prePromedio) {
            calculoDelCincoPorcieto = prePromedio * 5 / 100
            SaldoMenosCincoPorciento = prePromedio - calculoDelCincoPorcieto
            gananciaEstimada = SaldoMenosCincoPorciento - preMinimo
            return gananciaEstimada;
        }

        //Seleccion del dropdown de productos
        function SeleccionListaProducto() {
            dropdownProductosValor = document.getElementById("dropdownProductos").value
            dropdownTraductorValor = document.getElementById("dropdownTraductor").value
            //Carga la hora del ultimo escarneo
            lastUpdated()
            LimpiarTabla()

            if (dropdownProductosValor == "Plantas de classic") {
                urlPlantasVanilla.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });

            } else if (dropdownProductosValor == "Plantas de TBC") {
                urlPlantasTBC.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            } else if (dropdownProductosValor == "Pergaminos") {
                urlPergaminos.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            } else if (dropdownProductosValor == "Menas") {
                urlMenas.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            }
        }

        //selecion del dropdown traductor español ingles
        function SeleccionListaTraductor() {
            //obtiene el valor de ambos dropdown
            dropdownProductosValor = document.getElementById("dropdownProductos").value
            dropdownTraductorValor = document.getElementById("dropdownTraductor").value

            //Carga la hora del ultimo escarneo y se limpia la tabla
            lastUpdated()
            LimpiarTabla()

            //Se verifica cual producto esta seleccionado también
            if (dropdownProductosValor == "Plantas de classic") {
                urlPlantasVanilla.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });

            } else if (dropdownProductosValor == "Plantas de TBC") {
                urlPlantasTBC.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            } else if (dropdownProductosValor == "Pergaminos") {
                urlPergaminos.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            } else if (dropdownProductosValor == "Menas") {
                urlMenas.forEach(function (links, index, array) {
                    traerProductoDatos(links, index, array, dropdownTraductorValor)
                });
            }
        }

        //Limpia la tabla
        function LimpiarTabla() {
            var tableHeaderRowCount = 1;
            var table = document.getElementById('productos');
            var rowCount = table.rows.length;
            for (var i = tableHeaderRowCount; i < rowCount; i++) {
                table.deleteRow(tableHeaderRowCount);
            }
        }

        //Fecha de la ultima actualización
        function lastUpdated() {
            while (true) {
                try {
                    corsurl = "https://cors-anywhere.herokuapp.com/"
                    resultDate = fetch(corsurl + "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/scroll-of-agility-iv")
                        .then(resultDate => resultDate.json())
                        .then(function (fecha) {
                            const d = new Date(fecha.stats.lastUpdated);
                            hora = hora24a12(d.getHours())
                            minuto = d.getMinutes()
                            document.getElementById("lastUpdated").innerHTML = "Último escaneo: " + hora[0] + ":" + minuto + " " + hora[1];
                            console.log("Último escaneo: " + hora[0] + ":" + minuto + " " + hora[1])
                        })
                    break
                } catch (error) {
                    console.log(error)
                    sleep(2000)
                }
            }
        }

        //sugiere comprar hasta el 15% si la ganancia es mayor al 20%
        function CompraMaxima(prePromedio, porcentajeGanancia) {

            porcentajeEsperado = 20
            if (porcentajeGanancia >= porcentajeEsperado) {

                calculoDelCincoPorcieto1 = prePromedio * 5 / 100
                SaldoPromedioMenosCincoPorciento = prePromedio - calculoDelCincoPorcieto1
                //
                saldoCompraHasta15 = SaldoPromedioMenosCincoPorciento * 0.85
            } else {
                saldoCompraHasta15 = "-"
            }

            return saldoCompraHasta15

        }

        //sleep
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        //Cambia el horario 24 horas a 12 horas.
        function hora24a12(hora) {
            if (hora == 12) {
                hora = [12, "pm"]
            } else if (hora == 13) {
                hora = [1, "pm"]
            } else if (hora == 14) {
                hora = [2, "pm"]
            } else if (hora == 15) {
                hora = [3, "pm"]
            } else if (hora == 16) {
                hora = [4, "pm"]
            } else if (hora == 17) {
                hora = [5, "pm"]
            } else if (hora == 18) {
                hora = [6, "pm"]
            } else if (hora == 19) {
                hora = [7, "pm"]
            } else if (hora == 20) {
                hora = [8, "pm"]
            } else if (hora == 21) {
                hora = [9, "pm"]
            } else if (hora == 22) {
                hora = [10, "pm"]
            } else if (hora == 23) {
                hora = [11, "pm"]
            } else if (hora == 24) {
                hora = [12, "am"]
            } else if (hora == 0) {
                hora = [12, "am"]
            } else if (hora == 00) {
                hora = [12, "am"]
            } else {
                hora = [hora, "am"]
            }
            return hora;
        }

        //click al boton para activar cors
        function activarCors() {
            urlCors = "https://cors-anywhere.herokuapp.com/corsdemo"
            window.open(urlCors, "_blank");
        }

        //ordena la tabla de mayor a menor
        function compareValues(a, b) {
            // return -1/0/1 based on what you "know" a and b
            // are here. Numbers, text, some custom case-insensitive
            // and natural number ordering, etc. That's up to you.
            // A typical "do whatever JS would do" is:
            return (a > b) ? -1 : (a < b) ? 1 : 0;
        }

        function sortTable(colnum) {
            let tbody = tablaProducto.querySelector(`tbody`);
            let rows = Array.from(tablaProducto.querySelectorAll(`tr`));
            // but ignore the heading row:
            rows = rows.slice(1);
            posicion = colnum + 2
            // set up the queryselector for getting the indicated
            // column from a row, so we can compare using its value:
            let qs = `td:nth-child(${posicion})`;

            // and then just... sort the rows:
            rows.sort((r1, r2) => {
                // get each row's relevant column
                let t1 = r1.querySelector(qs);
                let t2 = r2.querySelector(qs);
                // and then effect sorting by comparing their content:
                return compareValues(t1.textContent, t2.textContent);
            });

            // and then the magic part that makes the sorting appear on-page:
            rows.forEach(row => tbody.appendChild(row));
        }
        tablaProducto.querySelectorAll(`th`).forEach((th, position) => {
            th.addEventListener(`click`, evt => sortTable(position));
        });

        //Traduce todos los productos
        function TraduccionName(inglesName) {
            //Traduccion plantas classic
            if (inglesName == "Peacebloom") {
                productName = "Flor de Paz"
            } else if (inglesName == "Silverleaf") {
                productName = "Hojaplata"
            } else if (inglesName == "Earthroot") {
                productName = "Raíz de tierra"
            } else if (inglesName == "Mageroyal") {
                productName = "Marregal"
            } else if (inglesName == "Briarthorn") {
                productName = "Brezospina"
            } else if (inglesName == "Stranglekelp") {
                productName = "Alga estranguladora"
            } else if (inglesName == "Bruiseweed") {
                productName = "Hierba cardenal"
            } else if (inglesName == "Wild Steelbloom") {
                productName = "Acérita salvaje"
            } else if (inglesName == "Grave Moss") {
                productName = "Musgo de tumba"
            } else if (inglesName == "Kingsblood") {
                productName = "Sangrerregia"
            } else if (inglesName == "Liferoot") {
                productName = "Vidarraíz"
            } else if (inglesName == "Fadeleaf") {
                productName = "Pálida"
            } else if (inglesName == "Goldthorn") {
                productName = "Espina de oro"
            } else if (inglesName == "Wintersbite") {
                productName = "Ivernalia"
            } else if (inglesName == "Khadgar's Whisker") {
                productName = "Mostacho de Khadgar"
            } else if (inglesName == "Purple Lotus") {
                productName = "Loto cárdeno"
            } else if (inglesName == "Firebloom") {
                productName = "Flor de Fuego"
            } else if (inglesName == "Arthas' Tears") {
                productName = "Lágrimas de Arthas"
            } else if (inglesName == "Golden Sansam") {
                productName = "Sansam dorado"
            } else if (inglesName == "Sungrass") {
                productName = "Solea"
            } else if (inglesName == "Blindweed") {
                productName = "Carolina"
            } else if (inglesName == "Dreamfoil") {
                productName = "Hojasueño"
            } else if (inglesName == "Mountain Silversage") {
                productName = "Salviargenta de montaña"
            } else if (inglesName == "Gromsblood") {
                productName = "Gromsanguina"
            } else if (inglesName == "Ghost Mushroom") {
                productName = "Champiñón fantasma"
            } else if (inglesName == "Plaguebloom") {
                productName = "Flor de peste"
            } else if (inglesName == "Icecap") {
                productName = "Setelo"
            }

            //Plantas de TBC
            else if (inglesName == "Felweed") {
                productName = "Hierba vil"
            } else if (inglesName == "Ragveil") {
                productName = "Velada"
            } else if (inglesName == "Netherbloom") {
                productName = "Flor abisal"
            } else if (inglesName == "Terocone") {
                productName = "Teropiña"
            } else if (inglesName == "Mana Thistle") {
                productName = "Cardo de maná"
            } else if (inglesName == "Ancient Lichen") {
                productName = "Liquen antiguo"
            } else if (inglesName == "Nightmare Vine") {
                productName = "Vid pesadilla"
            } else if (inglesName == "Dreaming Glory") {
                productName = "Gloria de ensueño"
            }

            //Pergaminos
            else if (inglesName == "Scroll of Agility IV") {
                productName = "Pergamino de Agilidad IV"
            } else if (inglesName == "Scroll of Strength IV") {
                productName = "Pergamino de Fuerza IV"
            } else if (inglesName == "Scroll of Strength V") {
                productName = "Pergamino de Fuerza V"
            } else if (inglesName == "Scroll of Agility V") {
                productName = "Pergamino de Agilidad V"
            } else if (inglesName == "Scroll of Spirit V") {
                productName = "Pergamino de espíritu V"
            }

            //Menas
            else if (inglesName == "Copper Ore") {
                productName = "Mena de cobre"
            } else if (inglesName == "Tin Ore") {
                productName = "Mena de estaño"
            } else if (inglesName == "Fel Iron Ore") {
                productName = "Mena de hierro vil"
            } else if (inglesName == "Nethercite Ore") {
                productName = "Mineral de abisalita"
            } else if (inglesName == "Dark Iron Ore") {
                productName = "Mena de hierro negro"
            } else if (inglesName == "Truesilver Ore") {
                productName = "Mena de Veraplata"
            } else if (inglesName == "Thorium Ore") {
                productName = "Mena de torio"
            } else if (inglesName == "Silver Ore") {
                productName = "Mena de plata"
            } else if (inglesName == "Gold Ore") {
                productName = "Mena de oro"
            } else if (inglesName == "Mithril Ore") {
                productName = "Mena de mitril"
            } else if (inglesName == "Adamantite Ore") {
                productName = "Mena de adamantita"
            } else if (inglesName == "Khorium Ore") {
                productName = "Mena de korio"
            } else if (inglesName == "Iron Ore") {
                productName = "Mena de hierro"
            }

            return productName;
        }


        //******************************* JS DE LA VENTANA **********************************

        //funcion que solicita los datos del url
        async function SolicitarDatos(precioVentaEnTablaNro, tipoMonedaOroPlataBronce, uniqueName) {

            if (tipoMonedaOroPlataBronce == "Oro") {
                precioVentaEnTablaNro = precioVentaEnTablaNro * 10000
                console.log("Es oro: " + precioVentaEnTablaNro)
            } else if (tipoMonedaOroPlataBronce == "Plata") {
                precioVentaEnTablaNro = precioVentaEnTablaNro * 100
                console.log("Es plata: " + precioVentaEnTablaNro)

            } else if (tipoMonedaOroPlataBronce == "Cobre") {
                precioVentaEnTablaNro = precioVentaEnTablaNro * 10
                console.log("Es plata: " + precioVentaEnTablaNro)
            }

            LimpiarTablaVerificacion()
            corsurl = "https://cors-anywhere.herokuapp.com/"
            Url = "https://api.nexushub.co/wow-classic/v1/items/pagle-alliance/" + uniqueName + "/prices"

            const respuesta = await fetch(corsurl + Url)
            const jsonResultado = await respuesta.json()
            for (let index = 0; index < jsonResultado.data.length; index++) {

                const d = new Date(jsonResultado.data[index].scannedAt);
                hora = hora24a12(d.getHours())
                minuto = d.getMinutes()
                horaMinutos = hora[0] + ":" + minuto + " " + hora[1]
                diaSemana = d.toString().split(" ")[0]
                precioCompra = jsonResultado.data[index].minBuyout

                if (precioCompra > precioVentaEnTablaNro) {
                    //verifica si el dia de la semana es el mismo o ha cambiado
                    if (diaSemana == diaSemanaAnterior) {
                        //en caso que sea el mismo dia
                        cantidades = cantidades + 1
                        diaSemanaAnterior = diaSemana
                        precioCompra = PlataOro(precioCompra / 10000)
                        crearColumna(diaSemana, cantidades, precioCompra, horaMinutos)

                    } else {
                        //cuando cambia a otro dia de la semana
                        cantidades = 1
                        diaSemanaAnterior = diaSemana
                        precioCompra = PlataOro(precioCompra / 10000)
                        crearColumna(diaSemana, cantidades, precioCompra, horaMinutos)
                    }
                }
            }

        }

        //agrega los datos de la tabla a la ventana
        function agregaDatosDeTablaAVentana(evt) {

        }

        //funcion que crea las columnas de la tabla
        function crearColumna(diaSemana, cantidades, precioCompra, Hora) {

            //crea un TR
            let fila = document.createElement('tr');

            //agrega la columna Día
            td = document.createElement('td');
            td.innerText = TraducirDiaSemana(diaSemana)
            td.setAttribute("style", "font-weight:bold");
            fila.appendChild(td);

            //agrega la columna #
            td = document.createElement('td');
            td.innerText = cantidades
            td.setAttribute("style", "font-weight:bold");
            fila.appendChild(td);
            tbody.appendChild(fila);

            //agrega la columna Precio Compra
            td = document.createElement('td');
            td.innerText = precioCompra
            td.setAttribute("style", "font-weight:bold");
            fila.appendChild(td);
            tbody.appendChild(fila);

            //agrega la columna Hora
            td = document.createElement('td');
            td.innerText = Hora
            td.setAttribute("style", "font-weight:bold");
            fila.appendChild(td);
            tbody.appendChild(fila);
        }

        //el Boton para hacer una nueva verificacion con otro precio de venta
        function cambiarPrecioVntaBtn() {
            campoTextPrecioVentaID = document.getElementById("PventaId")
            console.log(precioVentaEnTablaNro)
            console.log(tipoMonedaOroPlataBronce)
            campoTextPrecioVentaID = campoTextPrecioVentaID.value
            console.log(nombreUnico)
            SolicitarDatos(campoTextPrecioVentaID, tipoMonedaOroPlataBronce, nombreUnico)
        }

        //Limpia la tabla
        function LimpiarTablaVerificacion() {
            var tableHeaderRowCount = 1;
            var table = document.getElementById('tablaVerificacion');
            var rowCount = table.rows.length;
            for (var i = tableHeaderRowCount; i < rowCount; i++) {
                table.deleteRow(tableHeaderRowCount);
            }
        }

        //traduccion de dia de la semana
        function TraducirDiaSemana(diaSemana) {
            if (diaSemana == "Mon") {
                diaSemana = "Lunes"
            } else if (diaSemana == "Tue") {
                diaSemana = "Martes"
            } else if (diaSemana == "Wed") {
                diaSemana = "Miercoles"
            } else if (diaSemana == "Thu") {
                diaSemana = "Jueves"
            } else if (diaSemana == "Fri") {
                diaSemana = "Viernes"
            } else if (diaSemana == "Sat") {
                diaSemana = "Sabado"
            } else if (diaSemana == "Sun") {
                diaSemana = "Domingo"
            }

            return diaSemana;
        }

    </script>
</body>

</html>
